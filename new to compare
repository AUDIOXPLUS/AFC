<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>OnlyOffice Editor</title>

  <!-- 1) Carichiamo il config prima di tutto -->
  <script src="config.js"></script>

  <!-- 2) Usiamo APP_CONFIG.DOCS_URL per caricare api.js dinamicamente -->
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script');
      script.src = window.APP_CONFIG.DOCS_URL + '/web-apps/apps/api/documents/api.js';
      document.head.appendChild(script);
    })();
  </script>

  <style>
    html, body {
      height: 100%;
      margin: 0; 
      padding: 0;
      overflow: hidden;
    }
    #editor {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="editor"></div>

  <script type="text/javascript">
    // Funzione per ottenere i parametri dalla query string
    function getParameterByName(name) {
      name = name.replace(/[[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    // Ottieni il percorso del file dalla query string
    var filePath = getParameterByName('filePath');
    console.log('File richiesto per l\'editor:', filePath);

    if (!filePath) {
      alert('Parametro filePath mancante nell\'URL');
    } else {
      // Richiedi la configurazione dal server (usa BASE_URL invece di scrivere localhost o ip pubblico)
      var configUrl = window.APP_CONFIG.BASE_URL + '/onlyoffice/config?filePath=' + encodeURIComponent(filePath);
      console.log('Chiamo configUrl:', configUrl);

      fetch(configUrl)
        .then(function(response) {
          if (!response.ok) {
            throw new Error('Errore nella risposta del server: ' + response.status);
          }
          return response.json();
        })
        .then(function(config) {
          console.log('Configurazione ricevuta:', config);
          // ...
          var docEditor = new DocsAPI.DocEditor("editor", config);
        })
        .catch(function(error) {
          console.error('Errore durante il caricamento della configurazione:', error);
          alert('Errore durante il caricamento della configurazione: ' + error.message);
        });
    }
  </script>
</body>
</html>
